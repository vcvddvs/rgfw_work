{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { ref, onMounted } from 'vue';\nimport { useRouter } from 'vue-router';\nimport axios from 'axios';\nimport { orderApi } from '../utils/api';\nconst defaultImage = '/assets/img/default-food.png';\nexport default {\n  __name: 'historyComponent',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const router = useRouter();\n    const orders = ref([]);\n    onMounted(() => {\n      fetchOrders();\n    });\n    const goBack = () => {\n      router.push('/Index-Component');\n    };\n\n    // 处理图片URL，确保它们是有效的URL\n    const getImageUrl = imgPath => {\n      if (!imgPath) return defaultImage;\n\n      // 如果是base64数据或者无效URL，返回默认图片\n      if (imgPath.startsWith('data:') || imgPath.startsWith('iVBOR')) {\n        return defaultImage;\n      }\n\n      // 如果是相对路径，添加基础URL\n      if (imgPath.startsWith('/')) {\n        return `http://localhost:8090${imgPath}`;\n      }\n\n      // 如果已经是完整URL，直接返回\n      if (imgPath.startsWith('http')) {\n        return imgPath;\n      }\n\n      // 默认情况，假设是相对路径\n      return `http://localhost:8090/${imgPath}`;\n    };\n\n    // 处理图片加载错误\n    const handleImageError = e => {\n      e.target.src = defaultImage;\n    };\n    const fetchOrders = async () => {\n      try {\n        // 使用网关地址 (8090端口) 而不是直接访问后端服务\n        const response = await axios.get('http://localhost:8090/orders/history');\n        console.log('Order response:', response);\n\n        // 处理响应数据\n        let orderData = [];\n        if (response.data && response.data.data) {\n          // 如果是标准的Result格式\n          orderData = response.data.data;\n        } else if (Array.isArray(response.data)) {\n          // 如果直接返回数组\n          orderData = response.data;\n        }\n        orders.value = orderData.map(order => ({\n          ...order,\n          foodImgs: Array.isArray(order.foodImgs) ? order.foodImgs : order.foodImgs ? order.foodImgs.split(',') : [],\n          quantities: Array.isArray(order.quantities) ? order.quantities : order.quantities ? order.quantities.split(',').map(q => parseInt(q, 10)) : []\n        }));\n        console.log('Processed orders:', orders.value);\n      } catch (error) {\n        console.error('Error fetching orders:', error);\n      }\n    };\n    const __returned__ = {\n      router,\n      orders,\n      defaultImage,\n      goBack,\n      getImageUrl,\n      handleImageError,\n      fetchOrders,\n      ref,\n      onMounted,\n      get useRouter() {\n        return useRouter;\n      },\n      get axios() {\n        return axios;\n      },\n      get orderApi() {\n        return orderApi;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","useRouter","axios","orderApi","defaultImage","router","orders","fetchOrders","goBack","push","getImageUrl","imgPath","startsWith","handleImageError","e","target","src","response","get","console","log","orderData","data","Array","isArray","value","map","order","foodImgs","split","quantities","q","parseInt","error"],"sources":["D:/back_elm/vue_elm/src/components/historyComponent.vue"],"sourcesContent":["<template>\n  <div class=\"wrapper\">\n    <div class=\"header\">\n      <div class=\"search\">\n        <div class=\"search-bottom\">\n          <div class=\"back\">\n            <span class=\"iconfont icon-back\" @click=\"goBack\"></span>\n          </div>\n          <div class=\"search-pt\">\n            <span class=\"iconfont icon-sousuo\" style=\"margin-left: 2vw\"></span>\n            <input style=\"flex:6;\" type=\"text\" placeholder=\"历史信息搜索\"/>\n          </div>\n          <div class=\"box\">\n            <span class=\"iconfont icon-gongjuxiang\"></span>\n            <span class=\"iconfont icon-24gf-ellipsis\"></span>\n          </div>\n        </div>\n        <div class=\"information\">\n          <p>全部</p>\n          <p>进行中</p>\n          <p>待评价</p>\n          <p>退款</p>\n        </div>\n      </div>\n    </div>\n    <div class=\"body\">\n      <div v-for=\"order in orders\" :key=\"order.orderId\" class=\"food\" style=\"margin-top: 25vw\">\n        <div class=\"food-title\">\n          <div class=\"title-left\">\n            <img :src=\"getImageUrl(order.businessImg)\" @error=\"handleImageError\" height=\"52\" width=\"52\"/>\n          </div>\n          <div class=\"title-right\">\n            <div class=\"t-r-1\">\n              <div class=\"t-r-1-nb1\">\n                <p>{{ order.businessName }}</p>\n              </div>\n              <div class=\"t-r-1-nb2\">\n                <p>&#165;{{ order.orderTotal }}</p>\n              </div>\n            </div>\n            <div class=\"t-r-2\">\n              <p>{{ order.deliveryPrice }}元无门槛</p>\n            </div>\n          </div>\n        </div>\n        <div class=\"food-body\">\n          <div class=\"picture\">\n            <div v-for=\"(img, index) in order.foodImgs\" :key=\"img\" class=\"food-item\">\n              <img :src=\"getImageUrl(img)\" @error=\"handleImageError\" height=\"88\" width=\"88\"/>\n              <div class=\"quantity\">{{ order.quantities[index] }}</div>\n            </div>\n          </div>\n        <div class=\"time\">\n          <p>{{ order.orderDate }}</p>\n        </div>\n        <div class=\"one-more\">\n          <p>再来一单</p>\n        </div>\n      </div>\n    </div>\n  </div>\n  </div>\n</template>\n\n<script setup>\nimport { ref, onMounted } from 'vue';\nimport { useRouter } from 'vue-router';\nimport axios from 'axios';\nimport { orderApi } from '../utils/api';\n\nconst router = useRouter();\nconst orders = ref([]);\nconst defaultImage = '/assets/img/default-food.png';\n\nonMounted(() => {\n  fetchOrders();\n});\n\nconst goBack = () => {\n  router.push('/Index-Component');\n};\n\n// 处理图片URL，确保它们是有效的URL\nconst getImageUrl = (imgPath) => {\n  if (!imgPath) return defaultImage;\n  \n  // 如果是base64数据或者无效URL，返回默认图片\n  if (imgPath.startsWith('data:') || imgPath.startsWith('iVBOR')) {\n    return defaultImage;\n  }\n  \n  // 如果是相对路径，添加基础URL\n  if (imgPath.startsWith('/')) {\n    return `http://localhost:8090${imgPath}`;\n  }\n  \n  // 如果已经是完整URL，直接返回\n  if (imgPath.startsWith('http')) {\n    return imgPath;\n  }\n  \n  // 默认情况，假设是相对路径\n  return `http://localhost:8090/${imgPath}`;\n};\n\n// 处理图片加载错误\nconst handleImageError = (e) => {\n  e.target.src = defaultImage;\n};\n\nconst fetchOrders = async () => {\n  try {\n    // 使用网关地址 (8090端口) 而不是直接访问后端服务\n    const response = await axios.get('http://localhost:8090/orders/history');\n    console.log('Order response:', response);\n    \n    // 处理响应数据\n    let orderData = [];\n    if (response.data && response.data.data) {\n      // 如果是标准的Result格式\n      orderData = response.data.data;\n    } else if (Array.isArray(response.data)) {\n      // 如果直接返回数组\n      orderData = response.data;\n    }\n    \n    orders.value = orderData.map(order => ({\n      ...order,\n      foodImgs: Array.isArray(order.foodImgs) \n        ? order.foodImgs \n        : (order.foodImgs ? order.foodImgs.split(',') : []),\n      quantities: Array.isArray(order.quantities) \n        ? order.quantities \n        : (order.quantities ? order.quantities.split(',').map(q => parseInt(q, 10)) : [])\n    }));\n    \n    console.log('Processed orders:', orders.value);\n  } catch (error) {\n    console.error('Error fetching orders:', error);\n  }\n};\n</script>\n\n<style scoped>\n.wrapper{\n  width: 100%;\n  height: 100%;\n  background-color: aliceblue;\n}\n\n\n.wrapper .header{\n  background-color: aliceblue;\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  width: 100%;\n}\n\n\n.wrapper .header .search .search-bottom{\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding-top: 3vw;\n  height: 30px;\n\n}\n\n.wrapper .header .search .search-bottom .back .icon-back{\n  font-size: 20px;\n}\n\n\n\n.wrapper .header .search .search-bottom .search-pt{\n  position: relative;\n}\n.wrapper .header .search .search-bottom .search-pt input{\n  border: none;\n  padding-left: 30px;\n  margin-right: 3vw;\n  height: 25px;\n  border-radius: 15px;\n  font-size: 3.5vw;\n\n}\n\n\n.wrapper .header .search .search-bottom .search-pt .icon-sousuo{\n  position: relative;\n  top: 30%;\n  left: 30px; /* 调整图标在输入框中的位置 */\n  transform: translateY(-50%);\n  font-size: 15px; /* 调整图标的大小 */\n}\n.wrapper .header .search .search-bottom .back{\n  padding: 0 0 0 2vw;\n}\n\n\n.wrapper .header .search .search-bottom .box span{\n  padding: 0 2vw 0 2vw;\n  font-size: 20px;\n}\n\n.wrapper .header .search .information{\n  display: flex;\n  justify-content: space-around;\n\n}\n\n/*订单列表部分*/\n.wrapper .body .food{\n  width: 95%;\n  margin: 0 auto;\n  border-radius: 10px;\n  background-color: white;\n  margin-bottom: 2vw;\n}\n\n.wrapper .body .food .food-title{\n  display: flex;\n  align-items: center;\n  height: 60px;\n}\n\n.wrapper .body .food .food-title .title-left img{\n  width: 40px;\n  height: 40px;\n  padding: 2vw 2vw 2vw 2vw;\n  object-fit: cover;\n  border-radius: 5px;\n}\n\n.wrapper .body .food .food-title .title-right .t-r-1{\n  height: 5vw;\n  display: flex;\n  align-items: center;\n  justify-content: space-around;\n}\n\n.wrapper .body .food .food-title .title-right .t-r-1 .t-r-1-nb1{\n  display: flex;\n  align-items: center;\n  font-size: 4vw;\n}\n\n.wrapper .body .food .food-title .title-right .t-r-1 .t-r-1-nb1 p{\n  margin-top: 6vw;\n}\n\n.wrapper .body .food .food-title .title-right .t-r-1 .t-r-1-nb2{\n  padding-left: 13vw;\n  font-size: 3vw;\n  color: #9F9F9F;\n}\n\n.wrapper .body .food .food-title .title-right .t-r-1 .t-r-1-nb1 img{\n  height: 15px;\n  width: 10px;\n}\n\n.wrapper .body .food .food-title .title-right .t-r-2 p{\n  font-size: 2.6vw;\n  margin-top: 3vw;\n  border: 1px solid saddlebrown;\n  color: saddlebrown;\n  width: 55px;\n  display: flex;\n  justify-content: center;\n  border-radius: 5px;\n}\n\n.wrapper .body .food .food-body{\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 0 2vw 0 2vw;\n}\n\n.wrapper .body .food .food-body .picture {\n  display: flex;\n  flex-wrap: wrap;\n}\n\n.wrapper .body .food .food-body .picture .food-item {\n  position: relative;\n  margin-right: 5px;\n  margin-bottom: 5px;\n}\n\n.wrapper .body .food .food-body .picture .food-item img {\n  width: 60px;\n  height: 60px;\n  object-fit: cover;\n  border-radius: 5px;\n}\n\n.wrapper .body .food .food-body .picture .food-item .quantity {\n  position: absolute;\n  bottom: 0;\n  right: 0;\n  background-color: rgba(0,0,0,0.6);\n  color: white;\n  padding: 2px 5px;\n  border-radius: 3px;\n  font-size: 12px;\n}\n\n.wrapper .body .food .food-body .time {\n  font-size: 12px;\n  color: #999;\n}\n\n.wrapper .body .food .food-body .one-more {\n  background-color: #0097ff;\n  color: white;\n  padding: 5px 10px;\n  border-radius: 15px;\n  font-size: 12px;\n  cursor: pointer;\n}\n</style>"],"mappings":";AAiEA,SAASA,GAAG,EAAEC,SAAS,QAAQ,KAAK;AACpC,SAASC,SAAS,QAAQ,YAAY;AACtC,OAAOC,KAAK,MAAM,OAAO;AACzB,SAASC,QAAQ,QAAQ,cAAc;AAIvC,MAAMC,YAAY,GAAG,8BAA8B;;;;;;;IAFnD,MAAMC,MAAM,GAAGJ,SAAS,CAAC,CAAC;IAC1B,MAAMK,MAAM,GAAGP,GAAG,CAAC,EAAE,CAAC;IAGtBC,SAAS,CAAC,MAAM;MACdO,WAAW,CAAC,CAAC;IACf,CAAC,CAAC;IAEF,MAAMC,MAAM,GAAGA,CAAA,KAAM;MACnBH,MAAM,CAACI,IAAI,CAAC,kBAAkB,CAAC;IACjC,CAAC;;IAED;IACA,MAAMC,WAAW,GAAIC,OAAO,IAAK;MAC/B,IAAI,CAACA,OAAO,EAAE,OAAOP,YAAY;;MAEjC;MACA,IAAIO,OAAO,CAACC,UAAU,CAAC,OAAO,CAAC,IAAID,OAAO,CAACC,UAAU,CAAC,OAAO,CAAC,EAAE;QAC9D,OAAOR,YAAY;MACrB;;MAEA;MACA,IAAIO,OAAO,CAACC,UAAU,CAAC,GAAG,CAAC,EAAE;QAC3B,OAAO,wBAAwBD,OAAO,EAAE;MAC1C;;MAEA;MACA,IAAIA,OAAO,CAACC,UAAU,CAAC,MAAM,CAAC,EAAE;QAC9B,OAAOD,OAAO;MAChB;;MAEA;MACA,OAAO,yBAAyBA,OAAO,EAAE;IAC3C,CAAC;;IAED;IACA,MAAME,gBAAgB,GAAIC,CAAC,IAAK;MAC9BA,CAAC,CAACC,MAAM,CAACC,GAAG,GAAGZ,YAAY;IAC7B,CAAC;IAED,MAAMG,WAAW,GAAG,MAAAA,CAAA,KAAY;MAC9B,IAAI;QACF;QACA,MAAMU,QAAQ,GAAG,MAAMf,KAAK,CAACgB,GAAG,CAAC,sCAAsC,CAAC;QACxEC,OAAO,CAACC,GAAG,CAAC,iBAAiB,EAAEH,QAAQ,CAAC;;QAExC;QACA,IAAII,SAAS,GAAG,EAAE;QAClB,IAAIJ,QAAQ,CAACK,IAAI,IAAIL,QAAQ,CAACK,IAAI,CAACA,IAAI,EAAE;UACvC;UACAD,SAAS,GAAGJ,QAAQ,CAACK,IAAI,CAACA,IAAI;QAChC,CAAC,MAAM,IAAIC,KAAK,CAACC,OAAO,CAACP,QAAQ,CAACK,IAAI,CAAC,EAAE;UACvC;UACAD,SAAS,GAAGJ,QAAQ,CAACK,IAAI;QAC3B;QAEAhB,MAAM,CAACmB,KAAK,GAAGJ,SAAS,CAACK,GAAG,CAACC,KAAK,KAAK;UACrC,GAAGA,KAAK;UACRC,QAAQ,EAAEL,KAAK,CAACC,OAAO,CAACG,KAAK,CAACC,QAAQ,CAAC,GACnCD,KAAK,CAACC,QAAQ,GACbD,KAAK,CAACC,QAAQ,GAAGD,KAAK,CAACC,QAAQ,CAACC,KAAK,CAAC,GAAG,CAAC,GAAG,EAAG;UACrDC,UAAU,EAAEP,KAAK,CAACC,OAAO,CAACG,KAAK,CAACG,UAAU,CAAC,GACvCH,KAAK,CAACG,UAAU,GACfH,KAAK,CAACG,UAAU,GAAGH,KAAK,CAACG,UAAU,CAACD,KAAK,CAAC,GAAG,CAAC,CAACH,GAAG,CAACK,CAAC,IAAIC,QAAQ,CAACD,CAAC,EAAE,EAAE,CAAC,CAAC,GAAG;QAClF,CAAC,CAAC,CAAC;QAEHZ,OAAO,CAACC,GAAG,CAAC,mBAAmB,EAAEd,MAAM,CAACmB,KAAK,CAAC;MAChD,CAAC,CAAC,OAAOQ,KAAK,EAAE;QACdd,OAAO,CAACc,KAAK,CAAC,wBAAwB,EAAEA,KAAK,CAAC;MAChD;IACF,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}