{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { ref, onMounted } from 'vue';\nimport { useRouter } from 'vue-router';\nimport { orderApi } from '../utils/api';\nexport default {\n  __name: 'historyComponent',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const router = useRouter();\n    const orders = ref([]);\n    const loading = ref(false);\n\n    // 获取历史订单\n    const fetchOrders = async () => {\n      loading.value = true;\n      try {\n        const userId = localStorage.getItem('userId');\n        if (!userId) {\n          console.error('用户未登录');\n          router.push('/login-component');\n          return;\n        }\n        const response = await orderApi.getOrdersByUserId(userId);\n        if (response && response.data) {\n          orders.value = response.data;\n        }\n      } catch (error) {\n        console.error('获取订单失败:', error);\n      } finally {\n        loading.value = false;\n      }\n    };\n\n    // 处理图片URL\n    const getImageUrl = imgPath => {\n      if (!imgPath) return require('@/assets/default-business.png');\n      if (imgPath.startsWith('http')) {\n        return imgPath;\n      } else {\n        try {\n          return require('@/assets/' + imgPath);\n        } catch (e) {\n          return require('@/assets/default-business.png');\n        }\n      }\n    };\n\n    // 处理图片加载错误\n    const handleImageError = (event, type) => {\n      event.target.src = type === 'business' ? require('@/assets/default-business.png') : require('@/assets/default-food.png');\n    };\n\n    // 将逗号分隔的字符串转换为数组\n    const getArrayFromString = str => {\n      if (!str) return [];\n      return str.split(',');\n    };\n\n    // 再次下单\n    const reorder = order => {\n      // 实现再次下单逻辑\n      console.log('再次下单:', order);\n      // 可以导航到商家页面或直接添加到购物车\n    };\n\n    // 前往评价页面\n    const goToRating = order => {\n      router.push({\n        name: 'Rating',\n        params: {\n          orderId: order.orderId,\n          businessId: order.businessId,\n          businessName: order.businessName,\n          businessImg: order.businessImg,\n          orderDate: order.orderDate\n        }\n      });\n    };\n\n    // 返回上一页\n    const goBack = () => {\n      router.back();\n    };\n    onMounted(() => {\n      fetchOrders();\n    });\n    const __returned__ = {\n      router,\n      orders,\n      loading,\n      fetchOrders,\n      getImageUrl,\n      handleImageError,\n      getArrayFromString,\n      reorder,\n      goToRating,\n      goBack,\n      ref,\n      onMounted,\n      get useRouter() {\n        return useRouter;\n      },\n      get orderApi() {\n        return orderApi;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","useRouter","orderApi","router","orders","loading","fetchOrders","value","userId","localStorage","getItem","console","error","push","response","getOrdersByUserId","data","getImageUrl","imgPath","require","startsWith","e","handleImageError","event","type","target","src","getArrayFromString","str","split","reorder","order","log","goToRating","name","params","orderId","businessId","businessName","businessImg","orderDate","goBack","back"],"sources":["D:/back_elm/vue_elm/src/components/historyComponent.vue"],"sourcesContent":["<template>\n  <div class=\"wrapper\">\n    <header class=\"header\">\n      <div class=\"title\">\n        <div class=\"p1\">\n          <span class=\"iconfont icon-back\" style=\"font-size: 8vw\" @click=\"goBack\"></span>\n        </div>\n        <div class=\"p2\">\n          <p>历史订单</p>\n        </div>\n      </div>\n    </header>\n    <div class=\"body\">\n      <div v-for=\"order in orders\" :key=\"order.orderId\" class=\"order-card\">\n        <!-- 订单头部：商家信息和订单总价 -->\n        <div class=\"order-header\">\n          <div class=\"business-info\">\n            <img :src=\"getImageUrl(order.businessImg)\" @error=\"handleImageError($event, 'business')\" class=\"business-img\"/>\n            <div class=\"business-details\">\n              <div class=\"business-name\">{{ order.businessName }}</div>\n              <div class=\"delivery-price\">{{ order.deliveryPrice }}元无门槛</div>\n            </div>\n          </div>\n          <div class=\"order-price\">&#165;{{ order.orderTotal }}</div>\n        </div>\n        \n        <!-- 订单内容：食品列表 -->\n        <div class=\"order-content\">\n          <div class=\"food-list\">\n            <div v-for=\"(foodName, index) in getArrayFromString(order.foodNames)\" :key=\"index\" class=\"food-item\">\n              <div class=\"food-left\">\n                <img \n                  :src=\"getImageUrl(getArrayFromString(order.foodImgs)[index])\" \n                  @error=\"handleImageError($event, 'food')\" \n                  class=\"food-img\"\n                />\n              </div>\n              <div class=\"food-right\">\n                <div class=\"food-name\">{{ foodName }}</div>\n                <div class=\"food-quantity\">x{{ getArrayFromString(order.quantities)[index] || '1' }}</div>\n              </div>\n            </div>\n          </div>\n        </div>\n        \n        <!-- 订单底部：订单时间和操作按钮 -->\n        <div class=\"order-footer\">\n          <div class=\"order-date\">{{ order.orderDate }}</div>\n          <div class=\"order-actions\">\n            <button class=\"reorder-btn\" @click=\"reorder(order)\">再来一单</button>\n            <button class=\"rating-btn\" @click=\"goToRating(order)\">评价订单</button>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { ref, onMounted } from 'vue';\nimport { useRouter } from 'vue-router';\nimport { orderApi } from '../utils/api';\n\nconst router = useRouter();\nconst orders = ref([]);\nconst loading = ref(false);\n\n// 获取历史订单\nconst fetchOrders = async () => {\n  loading.value = true;\n  try {\n    const userId = localStorage.getItem('userId');\n    if (!userId) {\n      console.error('用户未登录');\n      router.push('/login-component');\n      return;\n    }\n    \n    const response = await orderApi.getOrdersByUserId(userId);\n    if (response && response.data) {\n      orders.value = response.data;\n    }\n  } catch (error) {\n    console.error('获取订单失败:', error);\n  } finally {\n    loading.value = false;\n  }\n};\n\n// 处理图片URL\nconst getImageUrl = (imgPath) => {\n  if (!imgPath) return require('@/assets/default-business.png');\n  \n  if (imgPath.startsWith('http')) {\n    return imgPath;\n  } else {\n    try {\n      return require('@/assets/' + imgPath);\n    } catch (e) {\n      return require('@/assets/default-business.png');\n    }\n  }\n};\n\n// 处理图片加载错误\nconst handleImageError = (event, type) => {\n  event.target.src = type === 'business' \n    ? require('@/assets/default-business.png') \n    : require('@/assets/default-food.png');\n};\n\n// 将逗号分隔的字符串转换为数组\nconst getArrayFromString = (str) => {\n  if (!str) return [];\n  return str.split(',');\n};\n\n// 再次下单\nconst reorder = (order) => {\n  // 实现再次下单逻辑\n  console.log('再次下单:', order);\n  // 可以导航到商家页面或直接添加到购物车\n};\n\n// 前往评价页面\nconst goToRating = (order) => {\n  router.push({\n    name: 'Rating',\n    params: {\n      orderId: order.orderId,\n      businessId: order.businessId,\n      businessName: order.businessName,\n      businessImg: order.businessImg,\n      orderDate: order.orderDate\n    }\n  });\n};\n\n// 返回上一页\nconst goBack = () => {\n  router.back();\n};\n\nonMounted(() => {\n  fetchOrders();\n});\n</script>\n\n<style scoped>\n.wrapper {\n  display: flex;\n  flex-direction: column;\n  min-height: 100vh;\n  background-color: #f5f5f5;\n}\n\n.header {\n  background-color: #0085ff;\n  color: white;\n  padding: 10px 0;\n}\n\n.title {\n  display: flex;\n  align-items: center;\n  padding: 0 15px;\n}\n\n.p1 {\n  width: 40px;\n}\n\n.p2 {\n  flex: 1;\n  text-align: center;\n  font-size: 18px;\n  font-weight: bold;\n}\n\n.body {\n  flex: 1;\n  padding: 15px;\n}\n\n.order-card {\n  background-color: white;\n  border-radius: 8px;\n  margin-bottom: 15px;\n  padding: 15px;\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n}\n\n.order-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding-bottom: 10px;\n  border-bottom: 1px solid #eee;\n}\n\n.business-info {\n  display: flex;\n  align-items: center;\n}\n\n.business-img {\n  width: 40px;\n  height: 40px;\n  border-radius: 20px;\n  object-fit: cover;\n  margin-right: 10px;\n}\n\n.business-name {\n  font-weight: bold;\n  margin-bottom: 3px;\n}\n\n.delivery-price {\n  font-size: 12px;\n  color: #999;\n}\n\n.order-price {\n  font-weight: bold;\n  color: #ff5722;\n}\n\n.order-content {\n  padding: 10px 0;\n}\n\n.food-item {\n  display: flex;\n  margin-bottom: 8px;\n}\n\n.food-left {\n  margin-right: 10px;\n}\n\n.food-img {\n  width: 50px;\n  height: 50px;\n  border-radius: 4px;\n  object-fit: cover;\n}\n\n.food-right {\n  flex: 1;\n}\n\n.food-name {\n  font-weight: 500;\n  margin-bottom: 3px;\n}\n\n.food-quantity {\n  font-size: 12px;\n  color: #666;\n}\n\n.order-footer {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding-top: 10px;\n  border-top: 1px solid #eee;\n}\n\n.order-date {\n  color: #999;\n  font-size: 12px;\n}\n\n.order-actions {\n  display: flex;\n  gap: 10px;\n}\n\n.reorder-btn, .rating-btn {\n  padding: 5px 12px;\n  border-radius: 15px;\n  font-size: 12px;\n  border: none;\n  cursor: pointer;\n}\n\n.reorder-btn {\n  background-color: #0085ff;\n  color: white;\n}\n\n.rating-btn {\n  background-color: #ff5722;\n  color: white;\n}\n</style>"],"mappings":";AA2DA,SAASA,GAAG,EAAEC,SAAS,QAAQ,KAAK;AACpC,SAASC,SAAS,QAAQ,YAAY;AACtC,SAASC,QAAQ,QAAQ,cAAc;;;;;;;IAEvC,MAAMC,MAAM,GAAGF,SAAS,CAAC,CAAC;IAC1B,MAAMG,MAAM,GAAGL,GAAG,CAAC,EAAE,CAAC;IACtB,MAAMM,OAAO,GAAGN,GAAG,CAAC,KAAK,CAAC;;IAE1B;IACA,MAAMO,WAAW,GAAG,MAAAA,CAAA,KAAY;MAC9BD,OAAO,CAACE,KAAK,GAAG,IAAI;MACpB,IAAI;QACF,MAAMC,MAAM,GAAGC,YAAY,CAACC,OAAO,CAAC,QAAQ,CAAC;QAC7C,IAAI,CAACF,MAAM,EAAE;UACXG,OAAO,CAACC,KAAK,CAAC,OAAO,CAAC;UACtBT,MAAM,CAACU,IAAI,CAAC,kBAAkB,CAAC;UAC/B;QACF;QAEA,MAAMC,QAAQ,GAAG,MAAMZ,QAAQ,CAACa,iBAAiB,CAACP,MAAM,CAAC;QACzD,IAAIM,QAAQ,IAAIA,QAAQ,CAACE,IAAI,EAAE;UAC7BZ,MAAM,CAACG,KAAK,GAAGO,QAAQ,CAACE,IAAI;QAC9B;MACF,CAAC,CAAC,OAAOJ,KAAK,EAAE;QACdD,OAAO,CAACC,KAAK,CAAC,SAAS,EAAEA,KAAK,CAAC;MACjC,CAAC,SAAS;QACRP,OAAO,CAACE,KAAK,GAAG,KAAK;MACvB;IACF,CAAC;;IAED;IACA,MAAMU,WAAW,GAAIC,OAAO,IAAK;MAC/B,IAAI,CAACA,OAAO,EAAE,OAAOC,OAAO,CAAC,+BAA+B,CAAC;MAE7D,IAAID,OAAO,CAACE,UAAU,CAAC,MAAM,CAAC,EAAE;QAC9B,OAAOF,OAAO;MAChB,CAAC,MAAM;QACL,IAAI;UACF,OAAOC,OAAO,CAAC,WAAW,GAAGD,OAAO,CAAC;QACvC,CAAC,CAAC,OAAOG,CAAC,EAAE;UACV,OAAOF,OAAO,CAAC,+BAA+B,CAAC;QACjD;MACF;IACF,CAAC;;IAED;IACA,MAAMG,gBAAgB,GAAGA,CAACC,KAAK,EAAEC,IAAI,KAAK;MACxCD,KAAK,CAACE,MAAM,CAACC,GAAG,GAAGF,IAAI,KAAK,UAAU,GAClCL,OAAO,CAAC,+BAA+B,CAAC,GACxCA,OAAO,CAAC,2BAA2B,CAAC;IAC1C,CAAC;;IAED;IACA,MAAMQ,kBAAkB,GAAIC,GAAG,IAAK;MAClC,IAAI,CAACA,GAAG,EAAE,OAAO,EAAE;MACnB,OAAOA,GAAG,CAACC,KAAK,CAAC,GAAG,CAAC;IACvB,CAAC;;IAED;IACA,MAAMC,OAAO,GAAIC,KAAK,IAAK;MACzB;MACApB,OAAO,CAACqB,GAAG,CAAC,OAAO,EAAED,KAAK,CAAC;MAC3B;IACF,CAAC;;IAED;IACA,MAAME,UAAU,GAAIF,KAAK,IAAK;MAC5B5B,MAAM,CAACU,IAAI,CAAC;QACVqB,IAAI,EAAE,QAAQ;QACdC,MAAM,EAAE;UACNC,OAAO,EAAEL,KAAK,CAACK,OAAO;UACtBC,UAAU,EAAEN,KAAK,CAACM,UAAU;UAC5BC,YAAY,EAAEP,KAAK,CAACO,YAAY;UAChCC,WAAW,EAAER,KAAK,CAACQ,WAAW;UAC9BC,SAAS,EAAET,KAAK,CAACS;QACnB;MACF,CAAC,CAAC;IACJ,CAAC;;IAED;IACA,MAAMC,MAAM,GAAGA,CAAA,KAAM;MACnBtC,MAAM,CAACuC,IAAI,CAAC,CAAC;IACf,CAAC;IAED1C,SAAS,CAAC,MAAM;MACdM,WAAW,CAAC,CAAC;IACf,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}