{"ast":null,"code":"import { createElementVNode as _createElementVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, toDisplayString as _toDisplayString } from \"vue\";\nconst _hoisted_1 = {\n  class: \"wrapper\"\n};\nconst _hoisted_2 = {\n  class: \"body\"\n};\nconst _hoisted_3 = {\n  class: \"order-header\"\n};\nconst _hoisted_4 = {\n  class: \"business-info\"\n};\nconst _hoisted_5 = [\"src\"];\nconst _hoisted_6 = {\n  class: \"business-details\"\n};\nconst _hoisted_7 = {\n  class: \"business-name\"\n};\nconst _hoisted_8 = {\n  class: \"delivery-price\"\n};\nconst _hoisted_9 = {\n  class: \"order-price\"\n};\nconst _hoisted_10 = {\n  class: \"order-content\"\n};\nconst _hoisted_11 = {\n  class: \"food-list\"\n};\nconst _hoisted_12 = {\n  class: \"food-left\"\n};\nconst _hoisted_13 = [\"src\"];\nconst _hoisted_14 = {\n  class: \"food-right\"\n};\nconst _hoisted_15 = {\n  class: \"food-name\"\n};\nconst _hoisted_16 = {\n  class: \"food-quantity\"\n};\nconst _hoisted_17 = {\n  class: \"order-footer\"\n};\nconst _hoisted_18 = {\n  class: \"order-date\"\n};\nconst _hoisted_19 = {\n  class: \"order-actions\"\n};\nconst _hoisted_20 = [\"onClick\"];\nconst _hoisted_21 = [\"onClick\"];\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"header\", {\n    class: \"header\"\n  }, [_createElementVNode(\"div\", {\n    class: \"title\"\n  }, [_createElementVNode(\"div\", {\n    class: \"p1\"\n  }, [_createElementVNode(\"span\", {\n    class: \"iconfont icon-back\",\n    style: {\n      \"font-size\": \"8vw\"\n    },\n    onClick: $setup.goBack\n  })]), _cache[2] || (_cache[2] = _createElementVNode(\"div\", {\n    class: \"p2\"\n  }, [_createElementVNode(\"p\", null, \"历史订单\")], -1 /* HOISTED */))])]), _createElementVNode(\"div\", _hoisted_2, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.orders, order => {\n    return _openBlock(), _createElementBlock(\"div\", {\n      key: order.orderId,\n      class: \"order-card\"\n    }, [_createCommentVNode(\" 订单头部：商家信息和订单总价 \"), _createElementVNode(\"div\", _hoisted_3, [_createElementVNode(\"div\", _hoisted_4, [_createElementVNode(\"img\", {\n      src: $setup.getImageUrl(order.businessImg),\n      onError: _cache[0] || (_cache[0] = $event => $setup.handleImageError($event, 'business')),\n      class: \"business-img\"\n    }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_5), _createElementVNode(\"div\", _hoisted_6, [_createElementVNode(\"div\", _hoisted_7, _toDisplayString(order.businessName), 1 /* TEXT */), _createElementVNode(\"div\", _hoisted_8, _toDisplayString(order.deliveryPrice) + \"元无门槛\", 1 /* TEXT */)])]), _createElementVNode(\"div\", _hoisted_9, \"¥\" + _toDisplayString(order.orderTotal), 1 /* TEXT */)]), _createCommentVNode(\" 订单内容：食品列表 \"), _createElementVNode(\"div\", _hoisted_10, [_createElementVNode(\"div\", _hoisted_11, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.getArrayFromString(order.foodNames), (foodName, index) => {\n      return _openBlock(), _createElementBlock(\"div\", {\n        key: index,\n        class: \"food-item\"\n      }, [_createElementVNode(\"div\", _hoisted_12, [_createElementVNode(\"img\", {\n        src: $setup.getImageUrl($setup.getArrayFromString(order.foodImgs)[index]),\n        onError: _cache[1] || (_cache[1] = $event => $setup.handleImageError($event, 'food')),\n        class: \"food-img\"\n      }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_13)]), _createElementVNode(\"div\", _hoisted_14, [_createElementVNode(\"div\", _hoisted_15, _toDisplayString(foodName), 1 /* TEXT */), _createElementVNode(\"div\", _hoisted_16, \"x\" + _toDisplayString($setup.getArrayFromString(order.quantities)[index] || '1'), 1 /* TEXT */)])]);\n    }), 128 /* KEYED_FRAGMENT */))])]), _createCommentVNode(\" 订单底部：订单时间和操作按钮 \"), _createElementVNode(\"div\", _hoisted_17, [_createElementVNode(\"div\", _hoisted_18, _toDisplayString(order.orderDate), 1 /* TEXT */), _createElementVNode(\"div\", _hoisted_19, [_createElementVNode(\"button\", {\n      class: \"reorder-btn\",\n      onClick: $event => $setup.reorder(order)\n    }, \"再来一单\", 8 /* PROPS */, _hoisted_20), order.orderState === 5 ? (_openBlock(), _createElementBlock(\"button\", {\n      key: 0,\n      class: \"rating-btn\",\n      onClick: $event => $setup.goToRating(order)\n    }, \"评价订单\", 8 /* PROPS */, _hoisted_21)) : _createCommentVNode(\"v-if\", true)])])]);\n  }), 128 /* KEYED_FRAGMENT */))])]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","_createElementVNode","style","onClick","$setup","goBack","_hoisted_2","_Fragment","_renderList","orders","order","key","orderId","_createCommentVNode","_hoisted_3","_hoisted_4","src","getImageUrl","businessImg","onError","_cache","$event","handleImageError","_hoisted_5","_hoisted_6","_hoisted_7","_toDisplayString","businessName","_hoisted_8","deliveryPrice","_hoisted_9","orderTotal","_hoisted_10","_hoisted_11","getArrayFromString","foodNames","foodName","index","_hoisted_12","foodImgs","_hoisted_13","_hoisted_14","_hoisted_15","_hoisted_16","quantities","_hoisted_17","_hoisted_18","orderDate","_hoisted_19","reorder","_hoisted_20","orderState","goToRating","_hoisted_21"],"sources":["D:\\back_elm\\vue_elm\\src\\components\\historyComponent.vue"],"sourcesContent":["<template>\n  <div class=\"wrapper\">\n    <header class=\"header\">\n      <div class=\"title\">\n        <div class=\"p1\">\n          <span class=\"iconfont icon-back\" style=\"font-size: 8vw\" @click=\"goBack\"></span>\n        </div>\n        <div class=\"p2\">\n          <p>历史订单</p>\n        </div>\n      </div>\n    </header>\n    <div class=\"body\">\n      <div v-for=\"order in orders\" :key=\"order.orderId\" class=\"order-card\">\n        <!-- 订单头部：商家信息和订单总价 -->\n        <div class=\"order-header\">\n          <div class=\"business-info\">\n            <img :src=\"getImageUrl(order.businessImg)\" @error=\"handleImageError($event, 'business')\" class=\"business-img\"/>\n            <div class=\"business-details\">\n              <div class=\"business-name\">{{ order.businessName }}</div>\n              <div class=\"delivery-price\">{{ order.deliveryPrice }}元无门槛</div>\n            </div>\n          </div>\n          <div class=\"order-price\">&#165;{{ order.orderTotal }}</div>\n        </div>\n        \n        <!-- 订单内容：食品列表 -->\n        <div class=\"order-content\">\n          <div class=\"food-list\">\n            <div v-for=\"(foodName, index) in getArrayFromString(order.foodNames)\" :key=\"index\" class=\"food-item\">\n              <div class=\"food-left\">\n                <img \n                  :src=\"getImageUrl(getArrayFromString(order.foodImgs)[index])\" \n                  @error=\"handleImageError($event, 'food')\" \n                  class=\"food-img\"\n                />\n              </div>\n              <div class=\"food-right\">\n                <div class=\"food-name\">{{ foodName }}</div>\n                <div class=\"food-quantity\">x{{ getArrayFromString(order.quantities)[index] || '1' }}</div>\n              </div>\n            </div>\n          </div>\n        </div>\n        \n        <!-- 订单底部：订单时间和操作按钮 -->\n        <div class=\"order-footer\">\n          <div class=\"order-date\">{{ order.orderDate }}</div>\n          <div class=\"order-actions\">\n            <button class=\"reorder-btn\" @click=\"reorder(order)\">再来一单</button>\n            <button class=\"rating-btn\" @click=\"goToRating(order)\" v-if=\"order.orderState === 5\">评价订单</button>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { ref, onMounted } from 'vue';\nimport { useRouter } from 'vue-router';\nimport { orderApi } from '../utils/api';\n\nconst router = useRouter();\nconst orders = ref([]);\nconst loading = ref(false);\n\n// 获取历史订单\nconst fetchOrders = async () => {\n  loading.value = true;\n  try {\n    const userId = localStorage.getItem('userId');\n    if (!userId) {\n      console.error('用户未登录');\n      router.push('/login-component');\n      return;\n    }\n    \n    const response = await orderApi.getOrdersByUserId(userId);\n    if (response && response.data) {\n      orders.value = response.data;\n    }\n  } catch (error) {\n    console.error('获取订单失败:', error);\n  } finally {\n    loading.value = false;\n  }\n};\n\n// 处理图片URL\nconst getImageUrl = (imgPath) => {\n  if (!imgPath) return require('../assets/img/default-business.png');\n  \n  if (imgPath.startsWith('http')) {\n    return imgPath;\n  } else {\n    try {\n      return require('../assets/' + imgPath);\n    } catch (e) {\n      return require('../assets/img/default-business.png');\n    }\n  }\n};\n\n// 处理图片加载错误\nconst handleImageError = (event, type) => {\n  event.target.src = type === 'business' \n    ? require('../assets/img/default-business.png') \n    : require('../assets/img/default-food.png');\n};\n\n// 将逗号分隔的字符串转换为数组\nconst getArrayFromString = (str) => {\n  if (!str) return [];\n  return str.split(',');\n};\n\n// 再次下单\nconst reorder = (order) => {\n  // 实现再次下单逻辑\n  console.log('再次下单:', order);\n  // 可以导航到商家页面或直接添加到购物车\n};\n\n// 前往评价页面\nconst goToRating = (order) => {\n  router.push({\n    name: 'Rating',\n    params: {\n      orderId: order.orderId,\n      businessId: order.businessId,\n      businessName: order.businessName,\n      businessImg: order.businessImg,\n      orderDate: order.orderDate\n    }\n  });\n};\n\n// 返回上一页\nconst goBack = () => {\n  router.back();\n};\n\nonMounted(() => {\n  fetchOrders();\n});\n</script>\n\n<style scoped>\n.wrapper {\n  display: flex;\n  flex-direction: column;\n  min-height: 100vh;\n  background-color: #f5f5f5;\n}\n\n.header {\n  background-color: #0085ff;\n  color: white;\n  padding: 10px 0;\n}\n\n.title {\n  display: flex;\n  align-items: center;\n  padding: 0 15px;\n}\n\n.p1 {\n  width: 40px;\n}\n\n.p2 {\n  flex: 1;\n  text-align: center;\n  font-size: 18px;\n  font-weight: bold;\n}\n\n.body {\n  flex: 1;\n  padding: 15px;\n}\n\n.order-card {\n  background-color: white;\n  border-radius: 8px;\n  margin-bottom: 15px;\n  padding: 15px;\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n}\n\n.order-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding-bottom: 10px;\n  border-bottom: 1px solid #eee;\n}\n\n.business-info {\n  display: flex;\n  align-items: center;\n}\n\n.business-img {\n  width: 40px;\n  height: 40px;\n  border-radius: 20px;\n  object-fit: cover;\n  margin-right: 10px;\n}\n\n.business-name {\n  font-weight: bold;\n  margin-bottom: 3px;\n}\n\n.delivery-price {\n  font-size: 12px;\n  color: #999;\n}\n\n.order-price {\n  font-weight: bold;\n  color: #ff5722;\n}\n\n.order-content {\n  padding: 10px 0;\n}\n\n.food-item {\n  display: flex;\n  margin-bottom: 8px;\n}\n\n.food-left {\n  margin-right: 10px;\n}\n\n.food-img {\n  width: 50px;\n  height: 50px;\n  border-radius: 4px;\n  object-fit: cover;\n}\n\n.food-right {\n  flex: 1;\n}\n\n.food-name {\n  font-weight: 500;\n  margin-bottom: 3px;\n}\n\n.food-quantity {\n  font-size: 12px;\n  color: #666;\n}\n\n.order-footer {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding-top: 10px;\n  border-top: 1px solid #eee;\n}\n\n.order-date {\n  color: #999;\n  font-size: 12px;\n}\n\n.order-actions {\n  display: flex;\n  gap: 10px;\n}\n\n.reorder-btn, .rating-btn {\n  padding: 5px 12px;\n  border-radius: 15px;\n  font-size: 12px;\n  border: none;\n  cursor: pointer;\n}\n\n.reorder-btn {\n  background-color: #0085ff;\n  color: white;\n}\n\n.rating-btn {\n  background-color: #ff5722;\n  color: white;\n}\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}