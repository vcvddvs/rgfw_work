{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { ref, onMounted } from 'vue';\nimport { useRoute } from 'vue-router';\nimport router from \"@/router\";\nimport { deliveryAddressApi } from '@/utils/api';\nimport axios from 'axios';\nexport default {\n  __name: 'updataComponent',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const route = useRoute();\n    const userId = ref(route.params.userId);\n    // 初始化地址对象\n    const address = ref({\n      contactName: '',\n      contactSex: 1,\n      contactTel: '',\n      address: '',\n      userId: userId.value\n    });\n    console.log(\"初始化地址表单，用户ID:\", userId.value);\n    onMounted(async () => {\n      // 从 localStorage 获取要编辑的地址\n      const selectedAddress = JSON.parse(localStorage.getItem('selectedAddressForEdit'));\n      if (selectedAddress) {\n        address.value = selectedAddress;\n        console.log(\"加载编辑地址:\", address.value);\n      } else {\n        address.value = {\n          contactName: '',\n          contactSex: 1,\n          contactTel: '',\n          address: '',\n          userId: userId.value\n        };\n        console.log(\"创建新地址，用户ID:\", userId.value);\n      }\n    });\n    const addAddress = async () => {\n      try {\n        // 确保发送请求时 address 对象包含必要的字段\n        if (!address.value.contactName || !address.value.address || !address.value.contactTel) {\n          alert('请填写完整的地址信息');\n          return;\n        }\n\n        // 确保发送请求时 address 对象包含 userId\n        if (address.value.daId) {\n          delete address.value.daId; // 新增地址不需要ID\n        }\n        if (!address.value.contactSex) {\n          address.value.contactSex = 1; // 默认为男性\n        }\n        address.value.userId = userId.value; // 确保这里正确设置了 userId\n\n        console.log(\"提交地址数据:\", address.value);\n        try {\n          // 尝试使用API网关调用微服务\n          const response = await deliveryAddressApi.addDeliveryAddress(address.value);\n          console.log(\"添加地址响应:\", response);\n          if (response && (response.code === 1 || response.success)) {\n            alert('地址添加成功');\n            router.back(); // 返回上一页\n            return;\n          }\n        } catch (apiError) {\n          console.error('通过API网关添加地址失败:', apiError);\n\n          // 如果通过网关失败，尝试直接调用服务\n          try {\n            console.log('尝试直接调用地址服务...');\n            // 使用axios直接调用服务\n            const directResponse = await axios.post('http://localhost:8086/deliveryAddress/', address.value, {\n              headers: {\n                'Content-Type': 'application/json',\n                'Authorization': localStorage.getItem('token') ? `Bearer ${localStorage.getItem('token')}` : ''\n              }\n            });\n            console.log('直接调用服务响应:', directResponse);\n            if (directResponse.data && (directResponse.data.code === 1 || directResponse.data.success)) {\n              alert('地址添加成功（直接调用服务）');\n              router.back(); // 返回上一页\n              return;\n            }\n          } catch (directError) {\n            console.error('直接调用服务也失败:', directError);\n          }\n        }\n\n        // 如果所有调用都失败，但尝试保存本地数据\n        const savedAddresses = JSON.parse(localStorage.getItem('userAddresses') || '[]');\n        const newAddress = {\n          ...address.value,\n          daId: Date.now()\n        }; // 使用时间戳作为临时ID\n        savedAddresses.push(newAddress);\n        localStorage.setItem('userAddresses', JSON.stringify(savedAddresses));\n        alert('网络连接问题，地址已临时保存');\n        router.back(); // 返回上一页\n      } catch (error) {\n        console.error('添加地址失败:', error);\n        alert('添加地址失败，请检查网络连接或稍后重试');\n      }\n    };\n    const __returned__ = {\n      route,\n      userId,\n      address,\n      addAddress,\n      ref,\n      onMounted,\n      get useRoute() {\n        return useRoute;\n      },\n      get router() {\n        return router;\n      },\n      get deliveryAddressApi() {\n        return deliveryAddressApi;\n      },\n      get axios() {\n        return axios;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","useRoute","router","deliveryAddressApi","axios","route","userId","params","address","contactName","contactSex","contactTel","value","console","log","selectedAddress","JSON","parse","localStorage","getItem","addAddress","alert","daId","response","addDeliveryAddress","code","success","back","apiError","error","directResponse","post","headers","data","directError","savedAddresses","newAddress","Date","now","push","setItem","stringify"],"sources":["D:/back_elm/vue_elm/src/components/updataComponent.vue"],"sourcesContent":["<template>\r\n  <div class=\"edit-address\">\r\n    <h2>添加新地址</h2>\r\n    <!-- 表单用于编辑地址 -->\r\n    <el-form ref=\"editAddressForm\" :model=\"address\" label-width=\"100px\">\r\n      <el-form-item label=\"地址\">\r\n        <el-input v-model=\"address.address\"></el-input>\r\n      </el-form-item>\r\n      <el-form-item label=\"联系人姓名\">\r\n        <el-input v-model=\"address.contactName\"></el-input>\r\n      </el-form-item>\r\n      <el-form-item label=\"联系电话\">\r\n        <el-input v-model=\"address.contactTel\"></el-input>\r\n      </el-form-item>\r\n      <el-form-item label=\"性别\">\r\n        <el-radio-group v-model=\"address.contactSex\">\r\n          <el-radio :label=\"1\">男</el-radio>\r\n          <el-radio :label=\"0\">女</el-radio>\r\n        </el-radio-group>\r\n      </el-form-item>\r\n      <el-button type=\"primary\" @click=\"addAddress\">保存</el-button>\r\n    </el-form>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted } from 'vue';\r\nimport { useRoute } from 'vue-router';\r\nimport router from \"@/router\";\r\nimport { deliveryAddressApi } from '@/utils/api';\r\nimport axios from 'axios';\r\n\r\nconst route = useRoute();\r\nconst userId = ref(route.params.userId);\r\n// 初始化地址对象\r\nconst address = ref({\r\n  contactName: '',\r\n  contactSex: 1,\r\n  contactTel: '',\r\n  address: '',\r\n  userId: userId.value\r\n});\r\n\r\nconsole.log(\"初始化地址表单，用户ID:\", userId.value);\r\n\r\nonMounted(async () => {\r\n  // 从 localStorage 获取要编辑的地址\r\n  const selectedAddress = JSON.parse(localStorage.getItem('selectedAddressForEdit'));\r\n  if (selectedAddress) {\r\n    address.value = selectedAddress;\r\n    console.log(\"加载编辑地址:\", address.value);\r\n  } else {\r\n    address.value = {\r\n      contactName: '',\r\n      contactSex: 1,\r\n      contactTel: '',\r\n      address: '',\r\n      userId: userId.value\r\n    };\r\n    console.log(\"创建新地址，用户ID:\", userId.value);\r\n  }\r\n});\r\n\r\nconst addAddress = async () => {\r\n  try {\r\n    // 确保发送请求时 address 对象包含必要的字段\r\n    if (!address.value.contactName || !address.value.address || !address.value.contactTel) {\r\n      alert('请填写完整的地址信息');\r\n      return;\r\n    }\r\n    \r\n    // 确保发送请求时 address 对象包含 userId\r\n    if (address.value.daId) {\r\n      delete address.value.daId; // 新增地址不需要ID\r\n    }\r\n    \r\n    if (!address.value.contactSex) {\r\n      address.value.contactSex = 1; // 默认为男性\r\n    }\r\n    \r\n    address.value.userId = userId.value; // 确保这里正确设置了 userId\r\n    \r\n    console.log(\"提交地址数据:\", address.value);\r\n    \r\n    try {\r\n      // 尝试使用API网关调用微服务\r\n      const response = await deliveryAddressApi.addDeliveryAddress(address.value);\r\n      console.log(\"添加地址响应:\", response);\r\n      \r\n      if (response && (response.code === 1 || response.success)) {\r\n        alert('地址添加成功');\r\n        router.back(); // 返回上一页\r\n        return;\r\n      }\r\n    } catch (apiError) {\r\n      console.error('通过API网关添加地址失败:', apiError);\r\n      \r\n      // 如果通过网关失败，尝试直接调用服务\r\n      try {\r\n        console.log('尝试直接调用地址服务...');\r\n        // 使用axios直接调用服务\r\n        const directResponse = await axios.post('http://localhost:8086/deliveryAddress/', address.value, {\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n            'Authorization': localStorage.getItem('token') ? `Bearer ${localStorage.getItem('token')}` : ''\r\n          }\r\n        });\r\n        \r\n        console.log('直接调用服务响应:', directResponse);\r\n        \r\n        if (directResponse.data && (directResponse.data.code === 1 || directResponse.data.success)) {\r\n          alert('地址添加成功（直接调用服务）');\r\n          router.back(); // 返回上一页\r\n          return;\r\n        }\r\n      } catch (directError) {\r\n        console.error('直接调用服务也失败:', directError);\r\n      }\r\n    }\r\n    \r\n    // 如果所有调用都失败，但尝试保存本地数据\r\n    const savedAddresses = JSON.parse(localStorage.getItem('userAddresses') || '[]');\r\n    const newAddress = { ...address.value, daId: Date.now() }; // 使用时间戳作为临时ID\r\n    savedAddresses.push(newAddress);\r\n    localStorage.setItem('userAddresses', JSON.stringify(savedAddresses));\r\n    \r\n    alert('网络连接问题，地址已临时保存');\r\n    router.back(); // 返回上一页\r\n    \r\n  } catch (error) {\r\n    console.error('添加地址失败:', error);\r\n    alert('添加地址失败，请检查网络连接或稍后重试');\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.edit-address {\r\n  max-width: 400px;\r\n  margin: 20px auto;\r\n  padding: 20px;\r\n  border: 1px solid #ebeef5;\r\n  border-radius: 4px;\r\n}\r\n\r\nh2 {\r\n  text-align: center;\r\n  margin-bottom: 20px;\r\n}\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}