{"ast":null,"code":"import axios from 'axios';\nimport { getToken, removeToken } from './auth';\n\n// 创建axios实例\nconst api = axios.create({\n  baseURL: 'http://localhost:8090',\n  // 通过API网关访问所有微服务\n  timeout: 5000,\n  withCredentials: false // 不携带凭证，避免CORS预检请求问题\n});\n\n// 请求拦截器\napi.interceptors.request.use(config => {\n  const token = getToken();\n  console.log('发送请求前的token:', token);\n  if (token) {\n    config.headers['Authorization'] = `Bearer ${token}`;\n    console.log('请求头中的Authorization:', config.headers['Authorization']);\n  } else {\n    console.warn('Token不存在，请求可能会被拒绝');\n  }\n  console.log('完整的请求配置:', {\n    url: config.url,\n    method: config.method,\n    headers: config.headers,\n    data: config.data\n  });\n  return config;\n}, error => {\n  console.error('请求拦截器错误:', error);\n  return Promise.reject(error);\n});\n\n// 响应拦截器\napi.interceptors.response.use(response => {\n  console.log('收到原始响应:', response);\n\n  // 处理不同的响应格式\n  if (response.data && response.data.code !== undefined) {\n    // 如果响应是标准的Result格式（包含code, msg, data）\n    console.log('识别为Result格式响应:', response.data);\n    return response.data;\n  } else if (Array.isArray(response.data)) {\n    // 如果直接返回了数组\n    console.log('识别为数组响应:', response.data);\n    return response.data;\n  } else if (response.data && typeof response.data === 'object') {\n    // 如果是普通对象但不是Result格式\n    console.log('识别为普通对象响应:', response.data);\n\n    // 特殊处理：检查是否为地址响应但成功字段为true的情况\n    if (response.data.success === true && response.config && response.config.url.includes('/deliveryAddress')) {\n      console.warn('检测到地址响应为success:true格式，尝试从数据库获取数据');\n      // 返回空数组避免前端错误\n      return [];\n    }\n    return response.data;\n  }\n\n  // 否则直接返回响应数据\n  console.log('返回原始响应数据:', response.data);\n  return response.data;\n}, error => {\n  console.error('响应错误:', error);\n  if (error.response?.status === 401) {\n    removeToken();\n    // 不在这里处理路由跳转，而是抛出特定的错误\n    error.isAuthError = true;\n  }\n  return Promise.reject(error);\n});\n\n// 用户相关API\nexport const userApi = {\n  login: data => api.post('/user/login', data),\n  register: data => api.post('/user/register', data),\n  getUserInfo: userId => api.get(`/user/${userId}`)\n};\n\n// 商家相关API\nexport const businessApi = {\n  getFoodList: businessId => api.get(`/business/${businessId}/foods`),\n  getBusinessInfo: businessId => api.get(`/business/${businessId}`),\n  getBusinessList: (page, size) => api.get(`/business/list?page=${page}&size=${size}`),\n  getBusinessById: businessId => api.get(`/business/${businessId}`),\n  getFoodsByBusinessId: businessId => api.get(`/food/listByBusinessId/${businessId}`)\n};\n\n// 订单相关API\nexport const orderApi = {\n  createOrder: data => api.post('/orders/', data),\n  getOrderById: orderId => api.get(`/orders/${orderId}`),\n  getOrdersByUserId: userId => api.get(`/orders/user/${userId}`)\n};\n\n// 购物车相关API\nexport const cartApi = {\n  addToCart: data => api.post('/cart/', data),\n  getCartByUserId: userId => api.get(`/cart/user/${userId}`),\n  deleteCartItem: cartId => api.delete(`/cart/${cartId}`),\n  checkout: data => api.post('/cart/checkout', data),\n  getCart: userId => api.get(`/cart/${userId}`),\n  updateCart: data => api.put('/cart', data)\n};\n\n// 配送地址相关API\nexport const deliveryAddressApi = {\n  getDeliveryAddressesByUserId: userId => api.get(`/deliveryAddress/listByUserId/${userId}`),\n  testGetDeliveryAddresses: userId => api.get(`/deliveryAddress/test/${userId}`),\n  addDeliveryAddress: data => api.post('/deliveryAddress/', data),\n  updateDeliveryAddress: data => api.put('/deliveryAddress/', data),\n  deleteDeliveryAddress: daId => api.delete(`/deliveryAddress/${daId}`)\n};\n\n// 支付相关API\nexport const paymentApi = {\n  processPayment: data => api.post('/payment/process', data),\n  verifyPayment: paymentId => api.get(`/payment/verify/${paymentId}`)\n};\n\n// 评价相关API\nexport const ratingApi = {\n  submitRating: data => api.post('/rating/', data),\n  getRatingsByBusinessId: businessId => api.get(`/rating/business/${businessId}`)\n};\nexport default api;","map":{"version":3,"names":["axios","getToken","removeToken","api","create","baseURL","timeout","withCredentials","interceptors","request","use","config","token","console","log","headers","warn","url","method","data","error","Promise","reject","response","code","undefined","Array","isArray","success","includes","status","isAuthError","userApi","login","post","register","getUserInfo","userId","get","businessApi","getFoodList","businessId","getBusinessInfo","getBusinessList","page","size","getBusinessById","getFoodsByBusinessId","orderApi","createOrder","getOrderById","orderId","getOrdersByUserId","cartApi","addToCart","getCartByUserId","deleteCartItem","cartId","delete","checkout","getCart","updateCart","put","deliveryAddressApi","getDeliveryAddressesByUserId","testGetDeliveryAddresses","addDeliveryAddress","updateDeliveryAddress","deleteDeliveryAddress","daId","paymentApi","processPayment","verifyPayment","paymentId","ratingApi","submitRating","getRatingsByBusinessId"],"sources":["D:/back_elm/vue_elm/src/utils/api.js"],"sourcesContent":["import axios from 'axios';\nimport { getToken, removeToken } from './auth';\n\n// 创建axios实例\nconst api = axios.create({\n  baseURL: 'http://localhost:8090', // 通过API网关访问所有微服务\n  timeout: 5000,\n  withCredentials: false // 不携带凭证，避免CORS预检请求问题\n});\n\n// 请求拦截器\napi.interceptors.request.use(\n  config => {\n    const token = getToken();\n    console.log('发送请求前的token:', token);\n    \n    if (token) {\n      config.headers['Authorization'] = `Bearer ${token}`;\n      console.log('请求头中的Authorization:', config.headers['Authorization']);\n    } else {\n      console.warn('Token不存在，请求可能会被拒绝');\n    }\n    \n    console.log('完整的请求配置:', {\n      url: config.url,\n      method: config.method,\n      headers: config.headers,\n      data: config.data\n    });\n    \n    return config;\n  },\n  error => {\n    console.error('请求拦截器错误:', error);\n    return Promise.reject(error);\n  }\n);\n\n// 响应拦截器\napi.interceptors.response.use(\n  response => {\n    console.log('收到原始响应:', response);\n    \n    // 处理不同的响应格式\n    if (response.data && response.data.code !== undefined) {\n      // 如果响应是标准的Result格式（包含code, msg, data）\n      console.log('识别为Result格式响应:', response.data);\n      return response.data;\n    } else if (Array.isArray(response.data)) {\n      // 如果直接返回了数组\n      console.log('识别为数组响应:', response.data);\n      return response.data;\n    } else if (response.data && typeof response.data === 'object') {\n      // 如果是普通对象但不是Result格式\n      console.log('识别为普通对象响应:', response.data);\n      \n      // 特殊处理：检查是否为地址响应但成功字段为true的情况\n      if (response.data.success === true && response.config && response.config.url.includes('/deliveryAddress')) {\n        console.warn('检测到地址响应为success:true格式，尝试从数据库获取数据');\n        // 返回空数组避免前端错误\n        return [];\n      }\n      \n      return response.data;\n    }\n    \n    // 否则直接返回响应数据\n    console.log('返回原始响应数据:', response.data);\n    return response.data;\n  },\n  error => {\n    console.error('响应错误:', error);\n    if (error.response?.status === 401) {\n      removeToken();\n      // 不在这里处理路由跳转，而是抛出特定的错误\n      error.isAuthError = true;\n    }\n    return Promise.reject(error);\n  }\n);\n\n// 用户相关API\nexport const userApi = {\n  login: (data) => api.post('/user/login', data),\n  register: (data) => api.post('/user/register', data),\n  getUserInfo: (userId) => api.get(`/user/${userId}`)\n};\n\n// 商家相关API\nexport const businessApi = {\n  getFoodList: (businessId) => api.get(`/business/${businessId}/foods`),\n  getBusinessInfo: (businessId) => api.get(`/business/${businessId}`),\n  getBusinessList: (page, size) => api.get(`/business/list?page=${page}&size=${size}`),\n  getBusinessById: (businessId) => api.get(`/business/${businessId}`),\n  getFoodsByBusinessId: (businessId) => api.get(`/food/listByBusinessId/${businessId}`)\n};\n\n// 订单相关API\nexport const orderApi = {\n  createOrder: (data) => api.post('/orders/', data),\n  getOrderById: (orderId) => api.get(`/orders/${orderId}`),\n  getOrdersByUserId: (userId) => api.get(`/orders/user/${userId}`)\n};\n\n// 购物车相关API\nexport const cartApi = {\n  addToCart: (data) => api.post('/cart/', data),\n  getCartByUserId: (userId) => api.get(`/cart/user/${userId}`),\n  deleteCartItem: (cartId) => api.delete(`/cart/${cartId}`),\n  checkout: (data) => api.post('/cart/checkout', data),\n  getCart: (userId) => api.get(`/cart/${userId}`),\n  updateCart: (data) => api.put('/cart', data),\n};\n\n// 配送地址相关API\nexport const deliveryAddressApi = {\n  getDeliveryAddressesByUserId: (userId) => api.get(`/deliveryAddress/listByUserId/${userId}`),\n  testGetDeliveryAddresses: (userId) => api.get(`/deliveryAddress/test/${userId}`),\n  addDeliveryAddress: (data) => api.post('/deliveryAddress/', data),\n  updateDeliveryAddress: (data) => api.put('/deliveryAddress/', data),\n  deleteDeliveryAddress: (daId) => api.delete(`/deliveryAddress/${daId}`)\n};\n\n// 支付相关API\nexport const paymentApi = {\n  processPayment: (data) => api.post('/payment/process', data),\n  verifyPayment: (paymentId) => api.get(`/payment/verify/${paymentId}`)\n};\n\n// 评价相关API\nexport const ratingApi = {\n  submitRating: (data) => api.post('/rating/', data),\n  getRatingsByBusinessId: (businessId) => api.get(`/rating/business/${businessId}`)\n};\n\nexport default api; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}