{"ast":null,"code":"import { createElementVNode as _createElementVNode, toDisplayString as _toDisplayString, resolveComponent as _resolveComponent, createVNode as _createVNode, createTextVNode as _createTextVNode, withCtx as _withCtx, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"rating-wrapper\"\n};\nconst _hoisted_2 = {\n  class: \"rating-header\"\n};\nconst _hoisted_3 = [\"src\"];\nconst _hoisted_4 = {\n  class: \"order-info\"\n};\nconst _hoisted_5 = {\n  class: \"business-info\"\n};\nconst _hoisted_6 = [\"src\"];\nconst _hoisted_7 = {\n  class: \"business-details\"\n};\nconst _hoisted_8 = {\n  class: \"rating-form\"\n};\nconst _hoisted_9 = {\n  class: \"rating-section\"\n};\nconst _hoisted_10 = {\n  class: \"star-rating\"\n};\nconst _hoisted_11 = {\n  class: \"rating-section\"\n};\nconst _hoisted_12 = {\n  class: \"star-rating\"\n};\nconst _hoisted_13 = {\n  class: \"rating-section\"\n};\nconst _hoisted_14 = {\n  class: \"submit-section\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_el_rate = _resolveComponent(\"el-rate\");\n  const _component_el_input = _resolveComponent(\"el-input\");\n  const _component_el_button = _resolveComponent(\"el-button\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"header\", _hoisted_2, [_createElementVNode(\"div\", {\n    class: \"back-button\",\n    onClick: $setup.goBack\n  }, [_cache[3] || (_cache[3] = _createElementVNode(\"i\", {\n    class: \"el-icon-arrow-left\"\n  }, null, -1 /* HOISTED */)), _createElementVNode(\"img\", {\n    src: require('@/assets/img_10.png'),\n    alt: \"返回\"\n  }, null, 8 /* PROPS */, _hoisted_3)]), _cache[4] || (_cache[4] = _createElementVNode(\"h2\", null, \"订单评价\", -1 /* HOISTED */))]), _createElementVNode(\"div\", _hoisted_4, [_createElementVNode(\"div\", _hoisted_5, [_createElementVNode(\"img\", {\n    src: $setup.businessImg || require('@/assets/default-business.png'),\n    alt: \"商家图片\",\n    class: \"business-img\"\n  }, null, 8 /* PROPS */, _hoisted_6), _createElementVNode(\"div\", _hoisted_7, [_createElementVNode(\"h3\", null, _toDisplayString($setup.businessName), 1 /* TEXT */), _createElementVNode(\"p\", null, \"订单编号: \" + _toDisplayString($setup.orderId), 1 /* TEXT */), _createElementVNode(\"p\", null, \"订单时间: \" + _toDisplayString($setup.orderDate), 1 /* TEXT */)])])]), _createElementVNode(\"div\", _hoisted_8, [_createElementVNode(\"div\", _hoisted_9, [_cache[5] || (_cache[5] = _createElementVNode(\"h3\", null, \"菜品评分\", -1 /* HOISTED */)), _createElementVNode(\"div\", _hoisted_10, [_createVNode(_component_el_rate, {\n    modelValue: $setup.foodRating,\n    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $setup.foodRating = $event),\n    colors: ['#99A9BF', '#F7BA2A', '#FF9900'],\n    \"show-text\": true,\n    texts: ['很差', '较差', '一般', '不错', '很好']\n  }, null, 8 /* PROPS */, [\"modelValue\"])])]), _createElementVNode(\"div\", _hoisted_11, [_cache[6] || (_cache[6] = _createElementVNode(\"h3\", null, \"配送评分\", -1 /* HOISTED */)), _createElementVNode(\"div\", _hoisted_12, [_createVNode(_component_el_rate, {\n    modelValue: $setup.deliveryRating,\n    \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => $setup.deliveryRating = $event),\n    colors: ['#99A9BF', '#F7BA2A', '#FF9900'],\n    \"show-text\": true,\n    texts: ['很差', '较差', '一般', '不错', '很好']\n  }, null, 8 /* PROPS */, [\"modelValue\"])])]), _createElementVNode(\"div\", _hoisted_13, [_cache[7] || (_cache[7] = _createElementVNode(\"h3\", null, \"评价内容\", -1 /* HOISTED */)), _createVNode(_component_el_input, {\n    type: \"textarea\",\n    modelValue: $setup.content,\n    \"onUpdate:modelValue\": _cache[2] || (_cache[2] = $event => $setup.content = $event),\n    rows: 4,\n    placeholder: \"请输入您的评价内容，分享您的用餐体验...\"\n  }, null, 8 /* PROPS */, [\"modelValue\"])]), _createElementVNode(\"div\", _hoisted_14, [_createVNode(_component_el_button, {\n    type: \"primary\",\n    onClick: $setup.submitRating,\n    disabled: $setup.isSubmitting\n  }, {\n    default: _withCtx(() => [_createTextVNode(_toDisplayString($setup.isSubmitting ? '提交中...' : '提交评价'), 1 /* TEXT */)]),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"disabled\"])])])]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","onClick","$setup","goBack","src","require","alt","_hoisted_3","_hoisted_4","_hoisted_5","businessImg","_hoisted_6","_hoisted_7","_toDisplayString","businessName","orderId","orderDate","_hoisted_8","_hoisted_9","_hoisted_10","_createVNode","_component_el_rate","modelValue","foodRating","_cache","$event","colors","texts","_hoisted_11","_hoisted_12","deliveryRating","_hoisted_13","_component_el_input","type","content","rows","placeholder","_hoisted_14","_component_el_button","submitRating","disabled","isSubmitting","default","_withCtx","_createTextVNode","_"],"sources":["D:\\back_elm\\vue_elm\\src\\components\\RatingComponent.vue"],"sourcesContent":["<template>\r\n  <div class=\"rating-wrapper\">\r\n    <header class=\"rating-header\">\r\n      <div class=\"back-button\" @click=\"goBack\">\r\n        <i class=\"el-icon-arrow-left\"></i>\r\n        <img :src=\"require('@/assets/img_10.png')\" alt=\"返回\">\r\n      </div>\r\n      <h2>订单评价</h2>\r\n    </header>\r\n\r\n    <div class=\"order-info\">\r\n      <div class=\"business-info\">\r\n        <img :src=\"businessImg || require('@/assets/default-business.png')\" alt=\"商家图片\" class=\"business-img\">\r\n        <div class=\"business-details\">\r\n          <h3>{{ businessName }}</h3>\r\n          <p>订单编号: {{ orderId }}</p>\r\n          <p>订单时间: {{ orderDate }}</p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"rating-form\">\r\n      <div class=\"rating-section\">\r\n        <h3>菜品评分</h3>\r\n        <div class=\"star-rating\">\r\n          <el-rate\r\n            v-model=\"foodRating\"\r\n            :colors=\"['#99A9BF', '#F7BA2A', '#FF9900']\"\r\n            :show-text=\"true\"\r\n            :texts=\"['很差', '较差', '一般', '不错', '很好']\"\r\n          ></el-rate>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"rating-section\">\r\n        <h3>配送评分</h3>\r\n        <div class=\"star-rating\">\r\n          <el-rate\r\n            v-model=\"deliveryRating\"\r\n            :colors=\"['#99A9BF', '#F7BA2A', '#FF9900']\"\r\n            :show-text=\"true\"\r\n            :texts=\"['很差', '较差', '一般', '不错', '很好']\"\r\n          ></el-rate>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"rating-section\">\r\n        <h3>评价内容</h3>\r\n        <el-input\r\n          type=\"textarea\"\r\n          v-model=\"content\"\r\n          :rows=\"4\"\r\n          placeholder=\"请输入您的评价内容，分享您的用餐体验...\"\r\n        ></el-input>\r\n      </div>\r\n\r\n      <div class=\"submit-section\">\r\n        <el-button type=\"primary\" @click=\"submitRating\" :disabled=\"isSubmitting\">\r\n          {{ isSubmitting ? '提交中...' : '提交评价' }}\r\n        </el-button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted } from 'vue';\r\nimport { useRoute, useRouter } from 'vue-router';\r\nimport { ratingApi } from '@/utils/api';\r\nimport { ElMessage } from 'element-plus';\r\n\r\nconst route = useRoute();\r\nconst router = useRouter();\r\n\r\n// 获取路由参数\r\nconst orderId = ref(route.params.orderId || '');\r\nconst businessId = ref(route.params.businessId || '');\r\nconst businessName = ref(route.params.businessName || '未知商家');\r\nconst businessImg = ref(route.params.businessImg || '');\r\nconst orderDate = ref(route.params.orderDate || '');\r\n\r\n// 评价表单数据\r\nconst foodRating = ref(5); // 默认5分\r\nconst deliveryRating = ref(5); // 默认5分\r\nconst content = ref('');\r\nconst isSubmitting = ref(false);\r\n\r\n// 返回上一页\r\nconst goBack = () => {\r\n  router.back();\r\n};\r\n\r\n// 提交评价\r\nconst submitRating = async () => {\r\n  if (foodRating.value === 0 || deliveryRating.value === 0) {\r\n    ElMessage.warning('请为菜品和配送服务评分');\r\n    return;\r\n  }\r\n\r\n  if (!content.value.trim()) {\r\n    ElMessage.warning('请输入评价内容');\r\n    return;\r\n  }\r\n\r\n  try {\r\n    isSubmitting.value = true;\r\n    \r\n    // 获取用户ID\r\n    const userId = localStorage.getItem('userId');\r\n    if (!userId) {\r\n      ElMessage.error('请先登录');\r\n      router.push('/login-component');\r\n      return;\r\n    }\r\n\r\n    // 构建评价数据\r\n    const ratingData = {\r\n      orderId: Number(orderId.value),\r\n      userId: userId,\r\n      businessId: Number(businessId.value),\r\n      foodRating: foodRating.value,\r\n      deliveryRating: deliveryRating.value,\r\n      content: content.value,\r\n    };\r\n\r\n    // 调用API提交评价\r\n    const response = await ratingApi.submitRating(ratingData);\r\n    \r\n    if (response && response.data) {\r\n      ElMessage.success('评价提交成功');\r\n      // 延迟后返回订单历史页面\r\n      setTimeout(() => {\r\n        router.push('/history-component');\r\n      }, 1500);\r\n    } else {\r\n      ElMessage.error('评价提交失败');\r\n    }\r\n  } catch (error) {\r\n    console.error('评价提交出错:', error);\r\n    ElMessage.error('评价提交出错: ' + (error.message || '未知错误'));\r\n  } finally {\r\n    isSubmitting.value = false;\r\n  }\r\n};\r\n\r\n// 组件加载时检查是否已经评价过\r\nonMounted(async () => {\r\n  try {\r\n    if (orderId.value) {\r\n      // 检查该订单是否已有评价\r\n      const response = await ratingApi.getRatingByOrderId(orderId.value);\r\n      if (response && response.data) {\r\n        // 已有评价，填充表单\r\n        foodRating.value = response.data.foodRating || 5;\r\n        deliveryRating.value = response.data.deliveryRating || 5;\r\n        content.value = response.data.content || '';\r\n        ElMessage.info('该订单已有评价，您可以修改后重新提交');\r\n      }\r\n    }\r\n  } catch (error) {\r\n    console.error('获取评价信息出错:', error);\r\n    // 获取失败不做特殊处理，当作新评价\r\n  }\r\n});\r\n</script>\r\n\r\n<style scoped>\r\n.rating-wrapper {\r\n  padding: 15px;\r\n  max-width: 600px;\r\n  margin: 0 auto;\r\n}\r\n\r\n.rating-header {\r\n  display: flex;\r\n  align-items: center;\r\n  margin-bottom: 20px;\r\n  position: relative;\r\n}\r\n\r\n.back-button {\r\n  position: absolute;\r\n  left: 0;\r\n  display: flex;\r\n  align-items: center;\r\n  cursor: pointer;\r\n}\r\n\r\n.back-button img {\r\n  width: 24px;\r\n  height: 24px;\r\n}\r\n\r\n.rating-header h2 {\r\n  flex: 1;\r\n  text-align: center;\r\n  margin: 0;\r\n  font-size: 18px;\r\n}\r\n\r\n.order-info {\r\n  background-color: #f8f8f8;\r\n  border-radius: 8px;\r\n  padding: 15px;\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.business-info {\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n\r\n.business-img {\r\n  width: 60px;\r\n  height: 60px;\r\n  border-radius: 4px;\r\n  object-fit: cover;\r\n  margin-right: 15px;\r\n}\r\n\r\n.business-details h3 {\r\n  margin: 0 0 5px 0;\r\n  font-size: 16px;\r\n}\r\n\r\n.business-details p {\r\n  margin: 3px 0;\r\n  font-size: 14px;\r\n  color: #666;\r\n}\r\n\r\n.rating-section {\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.rating-section h3 {\r\n  margin-bottom: 10px;\r\n  font-size: 16px;\r\n}\r\n\r\n.star-rating {\r\n  margin-bottom: 10px;\r\n}\r\n\r\n.submit-section {\r\n  margin-top: 30px;\r\n  text-align: center;\r\n}\r\n\r\n.submit-section button {\r\n  width: 80%;\r\n  max-width: 300px;\r\n}\r\n</style> "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}