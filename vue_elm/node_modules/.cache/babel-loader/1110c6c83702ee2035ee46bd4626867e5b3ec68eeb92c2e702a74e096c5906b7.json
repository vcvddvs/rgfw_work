{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { ref, onMounted } from 'vue';\nimport { useRouter } from 'vue-router';\nimport { orderApi } from '../utils/api';\nexport default {\n  __name: 'historyComponent',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const router = useRouter();\n    const orders = ref([]);\n    const activeTab = ref('all');\n    onMounted(() => {\n      fetchOrders();\n    });\n    const goBack = () => {\n      router.push('/Index-Component');\n    };\n    const setActiveTab = tab => {\n      activeTab.value = tab;\n      // 这里可以根据选中的标签筛选订单\n    };\n\n    // 将逗号分隔的字符串转换为数组\n    const getArrayFromString = str => {\n      if (!str) return [];\n      return str.split(',');\n    };\n\n    // 处理图片加载错误\n    const handleImageError = (e, type) => {\n      if (type === 'business') {\n        e.target.src = '/assets/img/BUSINESS/img.png';\n      } else {\n        e.target.src = '/assets/img/sp01.png';\n      }\n    };\n\n    // 再次下单\n    const reorder = order => {\n      // 实现再次下单功能\n      router.push(`/business-component/${order.businessId}`);\n    };\n    const fetchOrders = async () => {\n      try {\n        const response = await orderApi.getOrderHistory();\n        console.log('Order response:', response);\n        if (response && Array.isArray(response)) {\n          orders.value = response;\n        } else if (response && response.data && Array.isArray(response.data)) {\n          orders.value = response.data;\n        }\n        console.log('Processed orders:', orders.value);\n      } catch (error) {\n        console.error('Error fetching orders:', error);\n      }\n    };\n    const __returned__ = {\n      router,\n      orders,\n      activeTab,\n      goBack,\n      setActiveTab,\n      getArrayFromString,\n      handleImageError,\n      reorder,\n      fetchOrders,\n      ref,\n      onMounted,\n      get useRouter() {\n        return useRouter;\n      },\n      get orderApi() {\n        return orderApi;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","useRouter","orderApi","router","orders","activeTab","fetchOrders","goBack","push","setActiveTab","tab","value","getArrayFromString","str","split","handleImageError","e","type","target","src","reorder","order","businessId","response","getOrderHistory","console","log","Array","isArray","data","error"],"sources":["D:/back_elm/vue_elm/src/components/historyComponent.vue"],"sourcesContent":["<template>\n  <div class=\"wrapper\">\n    <div class=\"header\">\n      <div class=\"search\">\n        <div class=\"search-bottom\">\n          <div class=\"back\">\n            <span class=\"iconfont icon-back\" @click=\"goBack\"></span>\n          </div>\n          <div class=\"search-pt\">\n            <span class=\"iconfont icon-sousuo\" style=\"margin-left: 2vw\"></span>\n            <input style=\"flex:6;\" type=\"text\" placeholder=\"历史信息搜索\"/>\n          </div>\n          <div class=\"box\">\n            <span class=\"iconfont icon-gongjuxiang\"></span>\n            <span class=\"iconfont icon-24gf-ellipsis\"></span>\n          </div>\n        </div>\n        <div class=\"information\">\n          <p :class=\"{ active: activeTab === 'all' }\" @click=\"setActiveTab('all')\">全部</p>\n          <p :class=\"{ active: activeTab === 'inProgress' }\" @click=\"setActiveTab('inProgress')\">进行中</p>\n          <p :class=\"{ active: activeTab === 'toRate' }\" @click=\"setActiveTab('toRate')\">待评价</p>\n          <p :class=\"{ active: activeTab === 'refund' }\" @click=\"setActiveTab('refund')\">退款</p>\n        </div>\n      </div>\n    </div>\n    <div class=\"body\">\n      <div v-for=\"order in orders\" :key=\"order.orderId\" class=\"order-card\">\n        <div class=\"order-header\">\n          <div class=\"business-info\">\n            <img :src=\"order.businessImg\" @error=\"handleImageError($event, 'business')\" class=\"business-img\"/>\n            <div class=\"business-details\">\n              <div class=\"business-name\">{{ order.businessName }}</div>\n              <div class=\"delivery-price\">{{ order.deliveryPrice }}元无门槛</div>\n            </div>\n          </div>\n          <div class=\"order-price\">&#165;{{ order.orderTotal }}</div>\n        </div>\n        \n        <div class=\"order-items\">\n          <div v-for=\"(img, index) in getArrayFromString(order.foodImgs)\" :key=\"index\" class=\"food-item\">\n            <img :src=\"img\" @error=\"handleImageError($event, 'food')\" class=\"food-img\"/>\n            <div class=\"food-details\">\n              <div class=\"food-name\">{{ getArrayFromString(order.foodNames)[index] || '未知食品' }}</div>\n              <div class=\"quantity\">x{{ getArrayFromString(order.quantities)[index] || '1' }}</div>\n            </div>\n          </div>\n        </div>\n        \n        <div class=\"order-footer\">\n          <div class=\"order-date\">{{ order.orderDate }}</div>\n          <button class=\"reorder-btn\" @click=\"reorder(order)\">再来一单</button>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { ref, onMounted } from 'vue';\nimport { useRouter } from 'vue-router';\nimport { orderApi } from '../utils/api';\n\nconst router = useRouter();\nconst orders = ref([]);\nconst activeTab = ref('all');\n\nonMounted(() => {\n  fetchOrders();\n});\n\nconst goBack = () => {\n  router.push('/Index-Component');\n};\n\nconst setActiveTab = (tab) => {\n  activeTab.value = tab;\n  // 这里可以根据选中的标签筛选订单\n};\n\n// 将逗号分隔的字符串转换为数组\nconst getArrayFromString = (str) => {\n  if (!str) return [];\n  return str.split(',');\n};\n\n// 处理图片加载错误\nconst handleImageError = (e, type) => {\n  if (type === 'business') {\n    e.target.src = '/assets/img/BUSINESS/img.png';\n  } else {\n    e.target.src = '/assets/img/sp01.png';\n  }\n};\n\n// 再次下单\nconst reorder = (order) => {\n  // 实现再次下单功能\n  router.push(`/business-component/${order.businessId}`);\n};\n\nconst fetchOrders = async () => {\n  try {\n    const response = await orderApi.getOrderHistory();\n    console.log('Order response:', response);\n    \n    if (response && Array.isArray(response)) {\n      orders.value = response;\n    } else if (response && response.data && Array.isArray(response.data)) {\n      orders.value = response.data;\n    }\n    \n    console.log('Processed orders:', orders.value);\n  } catch (error) {\n    console.error('Error fetching orders:', error);\n  }\n};\n</script>\n\n<style scoped>\n.wrapper {\n  width: 100%;\n  height: 100%;\n  background-color: #f5f5f5;\n  padding-bottom: 20px;\n}\n\n.header {\n  background-color: white;\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  width: 100%;\n  z-index: 10;\n  box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n}\n\n.search-bottom {\n  display: flex;\n  align-items: center;\n  padding: 10px;\n  height: 40px;\n}\n\n.back .icon-back {\n  font-size: 20px;\n  padding: 0 10px;\n}\n\n.search-pt {\n  flex: 1;\n  position: relative;\n  display: flex;\n  align-items: center;\n}\n\n.search-pt input {\n  width: 100%;\n  border: none;\n  background-color: #f5f5f5;\n  padding: 8px 8px 8px 30px;\n  border-radius: 20px;\n  font-size: 14px;\n}\n\n.search-pt .icon-sousuo {\n  position: absolute;\n  left: 10px;\n  font-size: 16px;\n  color: #999;\n}\n\n.box span {\n  padding: 0 10px;\n  font-size: 20px;\n}\n\n.information {\n  display: flex;\n  justify-content: space-around;\n  padding: 10px 0;\n  border-bottom: 1px solid #eee;\n}\n\n.information p {\n  padding: 5px 10px;\n  cursor: pointer;\n  position: relative;\n}\n\n.information p.active {\n  color: #0097ff;\n  font-weight: bold;\n}\n\n.information p.active::after {\n  content: '';\n  position: absolute;\n  bottom: -5px;\n  left: 50%;\n  transform: translateX(-50%);\n  width: 20px;\n  height: 3px;\n  background-color: #0097ff;\n  border-radius: 3px;\n}\n\n.body {\n  margin-top: 100px;\n  padding: 10px;\n}\n\n.order-card {\n  background-color: white;\n  border-radius: 10px;\n  margin-bottom: 15px;\n  padding: 15px;\n  box-shadow: 0 1px 3px rgba(0,0,0,0.1);\n}\n\n.order-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding-bottom: 10px;\n  border-bottom: 1px solid #f0f0f0;\n}\n\n.business-info {\n  display: flex;\n  align-items: center;\n}\n\n.business-img {\n  width: 50px;\n  height: 50px;\n  border-radius: 5px;\n  object-fit: cover;\n  margin-right: 10px;\n}\n\n.business-details {\n  display: flex;\n  flex-direction: column;\n}\n\n.business-name {\n  font-weight: bold;\n  font-size: 16px;\n  margin-bottom: 5px;\n}\n\n.delivery-price {\n  font-size: 12px;\n  color: #ff6b01;\n  background-color: #fff5e6;\n  padding: 2px 5px;\n  border-radius: 3px;\n  display: inline-block;\n}\n\n.order-price {\n  font-size: 16px;\n  font-weight: bold;\n  color: #333;\n}\n\n.order-items {\n  display: flex;\n  flex-direction: column;\n  padding: 10px 0;\n}\n\n.food-item {\n  display: flex;\n  align-items: center;\n  margin-bottom: 10px;\n  background-color: #f9f9f9;\n  border-radius: 5px;\n  padding: 8px;\n}\n\n.food-img {\n  width: 60px;\n  height: 60px;\n  border-radius: 5px;\n  object-fit: cover;\n}\n\n.food-details {\n  margin-left: 10px;\n  flex: 1;\n}\n\n.food-name {\n  font-size: 14px;\n  margin-bottom: 5px;\n}\n\n.quantity {\n  font-size: 12px;\n  color: #666;\n  background-color: #f0f0f0;\n  padding: 2px 5px;\n  border-radius: 10px;\n  display: inline-block;\n}\n\n.order-footer {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding-top: 10px;\n  border-top: 1px solid #f0f0f0;\n}\n\n.order-date {\n  font-size: 12px;\n  color: #999;\n}\n\n.reorder-btn {\n  background-color: #0097ff;\n  color: white;\n  border: none;\n  padding: 8px 15px;\n  border-radius: 20px;\n  font-size: 14px;\n  cursor: pointer;\n}\n\n.reorder-btn:hover {\n  background-color: #0084e0;\n}\n</style>"],"mappings":";AA0DA,SAASA,GAAG,EAAEC,SAAS,QAAQ,KAAK;AACpC,SAASC,SAAS,QAAQ,YAAY;AACtC,SAASC,QAAQ,QAAQ,cAAc;;;;;;;IAEvC,MAAMC,MAAM,GAAGF,SAAS,CAAC,CAAC;IAC1B,MAAMG,MAAM,GAAGL,GAAG,CAAC,EAAE,CAAC;IACtB,MAAMM,SAAS,GAAGN,GAAG,CAAC,KAAK,CAAC;IAE5BC,SAAS,CAAC,MAAM;MACdM,WAAW,CAAC,CAAC;IACf,CAAC,CAAC;IAEF,MAAMC,MAAM,GAAGA,CAAA,KAAM;MACnBJ,MAAM,CAACK,IAAI,CAAC,kBAAkB,CAAC;IACjC,CAAC;IAED,MAAMC,YAAY,GAAIC,GAAG,IAAK;MAC5BL,SAAS,CAACM,KAAK,GAAGD,GAAG;MACrB;IACF,CAAC;;IAED;IACA,MAAME,kBAAkB,GAAIC,GAAG,IAAK;MAClC,IAAI,CAACA,GAAG,EAAE,OAAO,EAAE;MACnB,OAAOA,GAAG,CAACC,KAAK,CAAC,GAAG,CAAC;IACvB,CAAC;;IAED;IACA,MAAMC,gBAAgB,GAAGA,CAACC,CAAC,EAAEC,IAAI,KAAK;MACpC,IAAIA,IAAI,KAAK,UAAU,EAAE;QACvBD,CAAC,CAACE,MAAM,CAACC,GAAG,GAAG,8BAA8B;MAC/C,CAAC,MAAM;QACLH,CAAC,CAACE,MAAM,CAACC,GAAG,GAAG,sBAAsB;MACvC;IACF,CAAC;;IAED;IACA,MAAMC,OAAO,GAAIC,KAAK,IAAK;MACzB;MACAlB,MAAM,CAACK,IAAI,CAAC,uBAAuBa,KAAK,CAACC,UAAU,EAAE,CAAC;IACxD,CAAC;IAED,MAAMhB,WAAW,GAAG,MAAAA,CAAA,KAAY;MAC9B,IAAI;QACF,MAAMiB,QAAQ,GAAG,MAAMrB,QAAQ,CAACsB,eAAe,CAAC,CAAC;QACjDC,OAAO,CAACC,GAAG,CAAC,iBAAiB,EAAEH,QAAQ,CAAC;QAExC,IAAIA,QAAQ,IAAII,KAAK,CAACC,OAAO,CAACL,QAAQ,CAAC,EAAE;UACvCnB,MAAM,CAACO,KAAK,GAAGY,QAAQ;QACzB,CAAC,MAAM,IAAIA,QAAQ,IAAIA,QAAQ,CAACM,IAAI,IAAIF,KAAK,CAACC,OAAO,CAACL,QAAQ,CAACM,IAAI,CAAC,EAAE;UACpEzB,MAAM,CAACO,KAAK,GAAGY,QAAQ,CAACM,IAAI;QAC9B;QAEAJ,OAAO,CAACC,GAAG,CAAC,mBAAmB,EAAEtB,MAAM,CAACO,KAAK,CAAC;MAChD,CAAC,CAAC,OAAOmB,KAAK,EAAE;QACdL,OAAO,CAACK,KAAK,CAAC,wBAAwB,EAAEA,KAAK,CAAC;MAChD;IACF,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}